LoadPlugin java
<Plugin java>
    JVMArg "-Djava.class.path=/usr/share/collectd/java/collectd-api.jar:/usr/share/collectd/java/generic-jmx.jar"
    LoadPlugin "org.collectd.java.GenericJMX"
    <Plugin "GenericJMX">
        <MBean "memory">
            ObjectName "java.lang:type=Memory,*"
            InstancePrefix "activemq_java_memory"
            <Value>
                Type "memory"
                InstancePrefix "amq.heap-"
          	#InstanceFrom ""
          	Table true
          	Attribute "HeapMemoryUsage"
            </Value>

            <Value>
          	Type "memory"
          	InstancePrefix "amq.nonheap-"
          	#InstanceFrom ""
          	Table true
          	Attribute "NonHeapMemoryUsage"
            </Value>
        </MBean>

        <MBean "memory_pool">
            ObjectName "java.lang:type=MemoryPool,*"
            InstancePrefix "activemq_java_memory_pool-"
            InstanceFrom "name"
            <Value>
                Type "memory"
                InstancePrefix "amq.memory_pool"
                #InstanceFrom ""
                Table true
                Attribute "Usage"
            </Value>
        </MBean>

        # Garbage collector information
        <MBean "garbage_collector">
            ObjectName "java.lang:type=GarbageCollector,*"
            InstancePrefix "activemq_java_gc-"
            InstanceFrom "name"

            <Value>
                Type "invocations"
                InstancePrefix "amq.CollectionCount"
                #InstanceFrom ""
                Table false
                Attribute "CollectionCount"
            </Value>

            <Value>
                Type "total_time_in_ms"
                InstancePrefix "amq.collection_time"
                #InstanceFrom ""
                Table false
                Attribute "CollectionTime"
            </Value>
        </MBean>

        <MBean "classes">
            ObjectName "java.lang:type=ClassLoading"
            InstancePrefix "activemq_java"
            #InstanceFrom ""

            <Value>
                Type "gauge"
                InstancePrefix "amq.loaded_classes"
                #InstanceFrom ""
                Table false
                Attribute "LoadedClassCount"
            </Value>
        </MBean>
        <MBean "activemq-broker">
            ObjectName "org.apache.activemq:type=Broker,brokerName=*"
            InstanceFrom "brokerName"
            <Value>
                Type "counter"
                InstancePrefix "amq.TotalConnectionsCount"
                Table false
                Attribute "TotalConnectionsCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.TotalConsumerCount"
                Table false
                Attribute "TotalConsumerCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.TotalDequeueCount"
                Table false
                Attribute "TotalDequeueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.TotalEnqueueCount"
                Table false
                Attribute "TotalEnqueueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.TotalMessageCount"
                Table false
                Attribute "TotalMessageCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.TotalProducerCount"
                Table false
                Attribute "TotalProducerCount"
            </Value>
        </MBean>
        <MBean "activemq-queue">
            ObjectName "org.apache.activemq:type=Broker,brokerName=*,destinationType=Queue,destinationName=*"
            InstanceFrom "brokerName"
            InstanceFrom "destinationName"
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.QueueSize"
                Table false
                Attribute "QueueSize"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.AverageMessageSize"
                Table false
                Attribute "AverageMessageSize"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.ConsumerCount"
                Table false
                Attribute "ConsumerCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.ProducerCount"
                Table false
                Attribute "ProducerCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.DequeueCount"
                Table false
                Attribute "DequeueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.EnqueueCount"
                Table false
                Attribute "EnqueueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.ExpiredCount"
                Table false
                Attribute "ExpiredCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.ForwardCount"
                Table false
                Attribute "ForwardCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.InFlightCount"
                Table false
                Attribute "InFlightCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.AverageBlockedTime"
                Table false
                Attribute "AverageBlockedTime"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.AverageEnqueueTime"
                Table false
                Attribute "AverageEnqueueTime"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.BlockedSends"
                Table false
                Attribute "BlockedSends"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.queue.TotalBlockedTime"
                Table false
                Attribute "TotalBlockedTime"
            </Value>
        </MBean>
        <MBean "activemq-topic">
            ObjectName "org.apache.activemq:type=Broker,brokerName=*,destinationType=Topic,destinationName=*"
            InstanceFrom "brokerName"
            InstanceFrom "destinationName"
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.QueueSize"
                Table false
                Attribute "QueueSize"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.AverageMessageSize"
                Table false
                Attribute "AverageMessageSize"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.ConsumerCount"
                Table false
                Attribute "ConsumerCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.ProducerCount"
                Table false
                Attribute "ProducerCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.DequeueCount"
                Table false
                Attribute "DequeueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.EnqueueCount"
                Table false
                Attribute "EnqueueCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.ExpiredCount"
                Table false
                Attribute "ExpiredCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.ForwardCount"
                Table false
                Attribute "ForwardCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.InFlightCount"
                Table false
                Attribute "InFlightCount"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.AverageBlockedTime"
                Table false
                Attribute "AverageBlockedTime"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.AverageEnqueueTime"
                Table false
                Attribute "AverageEnqueueTime"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.BlockedSends"
                Table false
                Attribute "BlockedSends"
            </Value>
            <Value>
                Type "gauge"
                InstancePrefix "amq.topic.TotalBlockedTime"
                Table false
                Attribute "TotalBlockedTime"
            </Value>
        </MBean>
        <Connection>
            Host "{{ ansible_hostname }}"
            ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:{{ activemq_jmx_port }}/jmxrmi"
            User "{{ activemq_jmx_user }}"
            Password "{{ activemq_jmx_user_password }}"
            Collect "classes"
            Collect "garbage_collector"
            Collect "memory"
            Collect "memory_pool"
            Collect "activemq-broker"
            Collect "activemq-queue"
            Collect "activemq-topic"
        </Connection>
    </Plugin>
</Plugin>

LoadPlugin "target_replace"
<Chain "PostCache">
<Rule "strip_space">
   <Target "replace">
     PluginInstance " " "_"
     PluginInstance " " "_"
     PluginInstance " " "_"
     PluginInstance " " "_"
     PluginInstance "\"" ""
     PluginInstance "\"" ""
   </Target>
   <Target "write">
      Plugin "network"
   </Target>
</Rule>
</Chain>

# Replace plugin name from "GenericJMX" to "activemq"
PreCacheChain "PreCache"
LoadPlugin match_regex
LoadPlugin target_set
<Chain "PreCache">
    <Rule "rename_jmx">
        <Match "regex">
            Plugin "^GenericJMX$"
            TypeInstance "^amq.*"
        </Match>
        <Target "set">
            Plugin "activemq"
        </Target>
    </Rule>
</Chain>
